<!--JSON APIs with jQuery -->
<!-- http://stackoverflow.com/questions/14635133/weather-underground-api-forcast-help-javascript -->

<!DOCTYPE HTML>
<html>
<head>

<!--jQuery, linked from a CDN-->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>

<script>
    $(document).ready(function(){
    $(".flip").click(function () {
      $(".panel").toggle("slow");
    });
	});
</script>

<!-- Weather data from Wunderground, http://www.wunderground.com/weather/api/ -->
<script>
	var Wunderground_Key_ID = "Your Wunderground Key ID";
	var ZipCode = "Your Zip code";
jQuery(document).ready(function($) {
  $.ajax({
  url : "http://api.wunderground.com/api/" + Wunderground_Key_ID + "/conditions/forecast/q/" + ZipCode + ".json",
  dataType : "jsonp",
  success : function(parsed_json) {

  var temp_f = parsed_json['current_observation']['temp_f'] + '&#8457;' ;
  var current_conditions = parsed_json['current_observation']['weather']  ;
  var location = parsed_json['current_observation']['display_location']['full'];
  var icon_url_current = parsed_json['current_observation']['icon_url'];

  var image_current = "<img src=\""+ icon_url_current +"\" width=\"40\" height=\"40\" >";

  //Uncomment the following lines for more extensive and detailed forecast.
  //var forecast = parsed_json['forecast']['txt_forecast']['forecastday'];
  /*
  Index values:
  0 = Today
  1 = Tonight
  2 = Tomorrow
  */
  /*
  for (index in forecast)
  {
    var counter = parseInt(forecast[index]['period'])+1;
    var image = "<img src=\""+ forecast[index]['icon_url'] +"\" >";
    $("#c_forecast").append("<br/><b>[" + counter + "] " +  image + forecast[index]['title'] + ": "+ forecast[index]['fcttext'] + "</b>");
  }
  */

  //var forecast = parsed_json['forecast']['simpleforecast']['forecastday'];

  //interested in tomorrow's forecast
  //var index = 2;
  //$("#c_forecast").append("<b>" + forecast[index]['date']['weekday'] + " " + forecast[index]['conditions'] + ". High of " + forecast[index]['high']['fahrenheit'] + '&#8457;' + " and Low of " + forecast[index]['low']['fahrenheit'] + '&#8457;' + ".</b>");

  // uncomment for loop for multiple days.
  /*
  for (index in forecast)
  {
	 $("#c_forecast").append("<br/><b>" + forecast[index]['date']['weekday'] + " " + forecast[index]['conditions'] + ". High of " + forecast[index]['high']['fahrenheit'] + '&#8457;' + " and Low of " + forecast[index]['low']['fahrenheit'] + '&#8457;' + ".</b>");
  }
  */


  var forecast = parsed_json['forecast']['simpleforecast']['forecastday'];
  for (index in forecast)
  {
    var counter = parseInt(forecast[index]['period']);
    var image = "<img src=\""+ forecast[index]['icon_url'] +"\" width=\"40\" height=\"40\" >";
    var highAndLows = "<b>" + forecast[index]['high']['fahrenheit'] +"</b>"+ "|" + forecast[index]['low']['fahrenheit'] + ' &#8457; ';

	if(counter == 1){
	$("#c_forecast").append("<br/><td align=\"left\"><b>[" + counter + "] " +  image + "Today"  + "</b> " + highAndLows + forecast[index]['conditions']) + "</td>";
	}
	else{
	$("#c_forecast").append("<br/><td align=\"left\"><b>[" + counter + "] " +  image + forecast[index]['date']['weekday']  + "</b> " + highAndLows + forecast[index]['conditions']) + "</td>";
	}
  }

  $("#c_current_conditions").append("<br/><center>"+image_current+"<br/><b>" + current_conditions +"</b></center>");
  $("#c_location").append("<b>" + location +"</b>");
  $("#c_temperature").append("<br/><center><b><font size=\"6\">" + temp_f +"</font></b></center>");
  }
  });
});

	   </script>
	   <title>Control Panel - Weather</title>
       <meta name="author"   content="Gilberto Garc&#237;a"/>
       <meta name="mod-date" content="03/26/2013"/>
	   <meta charset="utf-8" />
       <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
       <meta name="apple-mobile-web-app-capable" content="yes" />
       <meta name="apple-mobile-web-app-status-bar-style" content="black" />   
       <link rel="stylesheet" type="text/css" href="WebResources/header_style.css"></style>
	   <link rel="stylesheet" type="text/css" href="WebResources/table_style.css"></style>
	   <link rel="stylesheet" type="text/css" href="WebResources/WeatherPanel_style.css"></style>
	</head>
	<body>
		<h1>Alarm Activity - Monitor System #1</h1>
        <br />
		Weather Condition
		<br />
		<p id="c_location">Location: </p>
        </br>
		<table class="gridtable" border="1"  >
		        <tr>
                   <td id="c_current_conditions"><center>Currently</center><br/></td>
				   <td id="c_temperature"><center>Temperature</center></td>
				</tr> 
	   </table>
	   	   
	   <p  class="flip">Click to show/hide forecast</p>
       <div  class="panel">
	   
	   <table class="gridtable" border="1" width="100%">
			<tr>
				<td id="c_forecast">Forecast:</td>
			</tr>
	   </table>
	   </div>
	   <br />
		
        <a href="/">Back to main page...</a>
        <br />
        <div style="border:1px solid #CCCCCC;">        <p><span class="note">Copyright &#169; 2012, 2013 Gilberto Garc&#237;a</span></p></div>

        </body>
</html>

